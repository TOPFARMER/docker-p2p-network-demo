#### 目的
为了方便学习共识算法，我打算在docker环境下建立一个小型p2p网络对共识算法进行实验，该网络基于nodejs以及websocket。

#### 实现
节点发现：每次使用docker swarm的编排时，每个容器节点的IP都是随机分配的VIP，各VIP能通过查询内部overlay网络的DNS service来发现，DNS service地址为127.0.0.11。

连接认证：目前使用简单的Hmac加密对所有服务器发起socket连接的req信息进行加密认证，所有服务器共享同一个密钥。

特性：docker swarm上使用docker-compose编排的replicas对外的端口唯一，同时swarm本身的overlay网络是自带负载均衡的，利用这一特点，客户端每次访问服务器群时，很容易达到选举主节点的效果。

#### 目前遇到的困难
1. 若两个节点几乎同时发起socket连接，会在两个节点之间生成两条socket连接，我称为连接冲突。由于websocket为全双工连接的特性，此冗余毫无意义，最好能避免。
   
   目前的解决方案是在各个节点部属初始化时，安排不同的节点以随机时间向其他节点发起连接，以减少冲突的可能性；以及发生连接冲突时，双方节点主动放弃已连接的两个socket，再经过一段随机长的时间后重新发起连接。

依靠负载均衡这种纯概率查询达到节点全覆盖不现实，尝试设置多次服务查询以及定时服务查询。

其他考虑：另外实现单一的发现服务器，每次节点入网从该服务器中登记自身IP并拿取网络节点IP表。

同时也可将该服务作为共识情况统计服务器以及密钥更新发放服务器。

#### TODO
- [ ] 网络监测服务 
- [ ] 简易连接检验
- [ ] 加入socket心跳检测功能

#### 编程缺陷